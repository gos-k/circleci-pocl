machine:
    services:
        - docker

dependencies:
    cache_directories:
        - ~/.docker
    override:
        - ls -la ~/.docker/*
        - docker images
        - if [ -e ~/.docker/image.tar ]; then docker load < ~/.docker/image.tar; fi
        - docker images
        - docker build -t $CIRCLE_PROJECT_REPONAME .
        - docker images
        - mkdir -p ~/.docker; docker save $CIRCLE_PROJECT_REPONAME > ~/.docker/image.tar
        - ls -la ~/.docker/*

test:
    override:
        - docker run -i -t circleci-pocl
